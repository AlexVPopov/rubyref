


<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title> | </title>

        <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/highlight.css">
        <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'>

        <!-- Font Awesome -->
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='/jquery.js'%3E%3C/script%3E"));
            }
        </script>
    </head>
    <body>
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme = localStorage.getItem('theme');
            if (theme == null) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = localStorage.getItem('sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter">

              
              <li>
                <a href="/about-this-book.html"> About This Book</a>
              </li>
                
              
              <li>
                <a href="/language.html"> Language Structure</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/language/keywords.html"> Keywords</a>
                          </li>
                        
                          <li>
                            <a href="/language/literals.html"> Literals</a>
                          </li>
                        
                          <li>
                            <a href="/language/variables-constants.html"> Variables and Constants</a>
                          </li>
                        
                          <li>
                            <a href="/language/assignment.html"> Assignment</a>
                          </li>
                        
                          <li>
                            <a href="/language/control-expressions.html"> Control Expressions</a>
                          </li>
                        
                          <li>
                            <a href="/language/methods-def.html"> Defining methods</a>
                          </li>
                        
                          <li>
                            <a href="/language/methods-call.html"> Calling methods</a>
                          </li>
                        
                          <li>
                            <a href="/language/modules-classes.html"> Modules and Classes</a>
                          </li>
                        
                          <li>
                            <a href="/language/exceptions.html"> Exceptions</a>
                          </li>
                        
                          <li>
                            <a href="/language/refinements.html"> Refinements</a>
                          </li>
                        
                          <li>
                            <a href="/language/precedence.html"> Precedence</a>
                          </li>
                        
                          <li>
                            <a href="/language/files.html"> File Structure</a>
                          </li>
                        
                          <li>
                            <a href="/language/globals.html"> Globals</a>
                          </li>
                        
                          <li>
                            <a href="/language/metaprogramming.html"> Metaprogramming</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/builtin.html"> Built-in Classes</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/builtin/core.html"> Language Core</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/types.html"> Value Types</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/errors-warnings.html"> Errors and Warnings</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/system-cli.html"> System Programming and CLI</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/concurrency-parallelism.html"> Concurrency and Parallelism</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/internals.html"> Interpreter Internals</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/marshal.html"> Marshal</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/random.html"> Random</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/stdlib.html"> Standard Library</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/stdlib/patterns.html"> Design Patterns</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/formats.html"> Formats</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/development-debugging.html"> Development and Debugging</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/string-utilities.html"> String Utilities</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/networking-web.html"> Networking and Web</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/cli.html"> System Programming and CLI</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/cryptography-encoding.html"> Cryptography and Encoding</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/misc.html"> Miscellaneous Libraries</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/advanced-topics.html"> Advanced Topics</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/advanced-topics/third-party-libraries.html"> Third-Party Libraries</a>
                          </li>
                        
                          <li>
                            <a href="/advanced-topics/tools-approaches.html"> Tools and Approaches</a>
                          </li>
                        
                          <li>
                            <a href="/advanced-topics/contributing.html"> Contributing To Ruby</a>
                          </li>
                        
                    </ul>
                
              

            </ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <i id="print-button" class="fa fa-print" title="Print this book"></i>
                    </div>
                </div>

                 <h1 id="concurrency-utils">Concurrency Utils</h1>

<h2 id="monitor">Monitor</h2>

<p>Use the Monitor class when you want to have a lock object for blocks
with mutual exclusion.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'monitor'</span>

<span class="n">lock</span> <span class="o">=</span> <span class="no">Monitor</span><span class="p">.</span><span class="nf">new</span>
<span class="n">lock</span><span class="p">.</span><span class="nf">synchronize</span> <span class="k">do</span>
  <span class="c1"># exclusive access</span>
<span class="k">end</span>
</code></pre></div></div>

<p><a href="https://ruby-doc.org/stdlib-2.5.0/libdoc/monitor/rdoc/Monitor.html">Monitor
Reference</a></p>

<h2 id="monitormixin">MonitorMixin</h2>

<p>In concurrent programming, a monitor is an object or module intended to
be used safely by more than one thread. The defining characteristic of a
monitor is that its methods are executed with mutual exclusion. That is,
at each point in time, at most one thread may be executing any of its
methods. This mutual exclusion greatly simplifies reasoning about the
implementation of monitors compared to reasoning about parallel code
that updates a data structure.</p>

<p>You can read more about the general principles on the Wikipedia page for
<a href="http://en.wikipedia.org/wiki/Monitor_%28synchronization%29">Monitors</a></p>

<h3 id="examples">Examples</h3>

<h4 id="simple-objectextend">Simple object.extend</h4>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'monitor.rb'</span>

<span class="n">buf</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">buf</span><span class="p">.</span><span class="nf">extend</span><span class="p">(</span><span class="no">MonitorMixin</span><span class="p">)</span>
<span class="n">empty_cond</span> <span class="o">=</span> <span class="n">buf</span><span class="p">.</span><span class="nf">new_cond</span>

<span class="c1"># consumer</span>
<span class="no">Thread</span><span class="p">.</span><span class="nf">start</span> <span class="k">do</span>
  <span class="kp">loop</span> <span class="k">do</span>
    <span class="n">buf</span><span class="p">.</span><span class="nf">synchronize</span> <span class="k">do</span>
      <span class="n">empty_cond</span><span class="p">.</span><span class="nf">wait_while</span> <span class="p">{</span> <span class="n">buf</span><span class="p">.</span><span class="nf">empty?</span> <span class="p">}</span>
      <span class="nb">print</span> <span class="n">buf</span><span class="p">.</span><span class="nf">shift</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># producer</span>
<span class="k">while</span> <span class="n">line</span> <span class="o">=</span> <span class="no">ARGF</span><span class="p">.</span><span class="nf">gets</span>
  <span class="n">buf</span><span class="p">.</span><span class="nf">synchronize</span> <span class="k">do</span>
    <span class="n">buf</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">empty_cond</span><span class="p">.</span><span class="nf">signal</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The consumer thread waits for the producer thread to push a line to buf
while <code class="highlighter-rouge">buf.empty?</code>. The producer thread (main thread) reads a line from
ARGF and pushes it into buf then calls <code class="highlighter-rouge">empty_cond.signal</code> to notify the
consumer thread of new data.</p>

<h4 id="simple-class-include">Simple Class include</h4>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'monitor'</span>

<span class="k">class</span> <span class="nc">SynchronizedArray</span> <span class="o">&lt;</span> <span class="no">Array</span>

  <span class="kp">include</span> <span class="no">MonitorMixin</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">alias</span> <span class="ss">:old_shift</span> <span class="ss">:shift</span>
  <span class="k">alias</span> <span class="ss">:old_unshift</span> <span class="ss">:unshift</span>

  <span class="k">def</span> <span class="nf">shift</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">synchronize</span> <span class="k">do</span>
      <span class="nb">self</span><span class="p">.</span><span class="nf">old_shift</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">unshift</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="nb">self</span><span class="p">.</span><span class="nf">synchronize</span> <span class="k">do</span>
      <span class="nb">self</span><span class="p">.</span><span class="nf">old_unshift</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c1"># other methods ...</span>
<span class="k">end</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">SynchronizedArray</code> implements an Array with synchronized access to
items. This Class is implemented as subclass of Array which includes the
MonitorMixin module.</p>

<p><a href="https://ruby-doc.org/stdlib-2.5.0/libdoc/monitor/rdoc/MonitorMixin.html">MonitorMixin
Reference</a></p>

<h2 id="mutex_m">Mutex_m</h2>

<h2 id="mutex_mrb">mutex_m.rb</h2>

<p>When ‘mutex_m’ is required, any object that extends or includes
Mutex_m will be treated like a Mutex.</p>

<p>Start by requiring the standard library Mutex_m:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"mutex_m.rb"</span>
</code></pre></div></div>

<p>From here you can extend an object with Mutex instance methods:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">obj</span> <span class="o">=</span> <span class="no">Object</span><span class="p">.</span><span class="nf">new</span>
<span class="n">obj</span><span class="p">.</span><span class="nf">extend</span> <span class="no">Mutex_m</span>
</code></pre></div></div>

<p>Or mixin Mutex_m into your module to your class inherit Mutex instance
methods.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Foo</span>
  <span class="kp">include</span> <span class="no">Mutex_m</span>
  <span class="c1"># ...</span>
<span class="k">end</span>
<span class="n">obj</span> <span class="o">=</span> <span class="no">Foo</span><span class="p">.</span><span class="nf">new</span>
<span class="c1"># this obj can be handled like Mutex</span>
</code></pre></div></div>

<p><a href="https://ruby-doc.org/stdlib-2.5.0/libdoc/mutex_m/rdoc/Mutex_m.html">Mutex_m
Reference</a></p>

<h2 id="sync">Sync</h2>

<p>A class that provides two-phase lock with a counter. See Sync_m for
details.</p>

<p><a href="https://ruby-doc.org/stdlib-2.5.0/libdoc/sync/rdoc/Sync.html">Sync
Reference</a></p>

<h2 id="sync_m">Sync_m</h2>

<p>A module that provides a two-phase lock with a counter.</p>

<p><a href="https://ruby-doc.org/stdlib-2.5.0/libdoc/sync/rdoc/Sync_m.html">Sync_m
Reference</a></p>

<h2 id="synchronizer">Synchronizer</h2>

<p>A class that provides two-phase lock with a counter. See Sync_m for
details.</p>

<p><a href="https://ruby-doc.org/stdlib-2.5.0/libdoc/sync/rdoc/Synchronizer.html">Synchronizer
Reference</a></p>

<h2 id="synchronizer_m">Synchronizer_m</h2>

<p>A module that provides a two-phase lock with a counter.</p>

<p><a href="https://ruby-doc.org/stdlib-2.5.0/libdoc/sync/rdoc/Synchronizer_m.html">Synchronizer_m
Reference</a></p>



                <!-- Mobile navigation buttons -->


                <!--
                    <a href="cli/cli-tool.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                 -->

            </div>



               <!--
                <a href="cli/cli-tool.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
                 -->

        </div>


        <script src="/js/book.js"></script>
    </body>
</html>

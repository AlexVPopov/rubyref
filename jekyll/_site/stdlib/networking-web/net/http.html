


<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title> | </title>

        <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/highlight.css">
        <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'>

        <!-- Font Awesome -->
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='/jquery.js'%3E%3C/script%3E"));
            }
        </script>
    </head>
    <body>
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme = localStorage.getItem('theme');
            if (theme == null) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = localStorage.getItem('sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter">

              
              <li>
                <a href="/about-this-book.html"> About This Book</a>
              </li>
                
              
              <li>
                <a href="/language.html"> Language Structure</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/language/keywords.html"> Keywords</a>
                          </li>
                        
                          <li>
                            <a href="/language/literals.html"> Literals</a>
                          </li>
                        
                          <li>
                            <a href="/language/variables-constants.html"> Variables and Constants</a>
                          </li>
                        
                          <li>
                            <a href="/language/assignment.html"> Assignment</a>
                          </li>
                        
                          <li>
                            <a href="/language/control-expressions.html"> Control Expressions</a>
                          </li>
                        
                          <li>
                            <a href="/language/methods-def.html"> Defining methods</a>
                          </li>
                        
                          <li>
                            <a href="/language/methods-call.html"> Calling methods</a>
                          </li>
                        
                          <li>
                            <a href="/language/modules-classes.html"> Modules and Classes</a>
                          </li>
                        
                          <li>
                            <a href="/language/exceptions.html"> Exceptions</a>
                          </li>
                        
                          <li>
                            <a href="/language/refinements.html"> Refinements</a>
                          </li>
                        
                          <li>
                            <a href="/language/precedence.html"> Precedence</a>
                          </li>
                        
                          <li>
                            <a href="/language/files.html"> File Structure</a>
                          </li>
                        
                          <li>
                            <a href="/language/globals.html"> Globals</a>
                          </li>
                        
                          <li>
                            <a href="/language/metaprogramming.html"> Metaprogramming</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/builtin.html"> Built-in Classes</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/builtin/core.html"> Language Core</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/types.html"> Value Types</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/errors-warnings.html"> Errors and Warnings</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/system-cli.html"> System Programming and CLI</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/concurrency-parallelism.html"> Concurrency and Parallelism</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/internals.html"> Interpreter Internals</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/marshal.html"> Marshal</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/random.html"> Random</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/stdlib.html"> Standard Library</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/stdlib/patterns.html"> Design Patterns</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/formats.html"> Formats</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/development-debugging.html"> Development and Debugging</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/string-utilities.html"> String Utilities</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/networking-web.html"> Networking and Web</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/cli.html"> System Programming and CLI</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/cryptography-encoding.html"> Cryptography and Encoding</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/misc.html"> Miscellaneous Libraries</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/advanced-topics.html"> Advanced Topics</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/advanced-topics/third-party-libraries.html"> Third-Party Libraries</a>
                          </li>
                        
                          <li>
                            <a href="/advanced-topics/tools-approaches.html"> Tools and Approaches</a>
                          </li>
                        
                          <li>
                            <a href="/advanced-topics/contributing.html"> Contributing To Ruby</a>
                          </li>
                        
                    </ul>
                
              

            </ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <i id="print-button" class="fa fa-print" title="Print this book"></i>
                    </div>
                </div>

                 
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'net/http'</span>
</code></pre></div></div>

<h1 id="nethttp">Net::HTTP</h1>

<h2 id="an-http-client-api-for-ruby">An HTTP client API for Ruby.</h2>

<p>Net::HTTP provides a rich library which can be used to build HTTP
user-agents. For more details about HTTP see
<a href="http://www.ietf.org/rfc/rfc2616.txt">RFC2616</a></p>

<p>Net::HTTP is designed to work closely with URI. <code class="highlighter-rouge">URI::HTTP#host</code>,
U<code class="highlighter-rouge">RI::HTTP#port</code> and <code class="highlighter-rouge">URI::HTTP#request_uri</code> are designed to work with
Net::HTTP.</p>

<p>If you are only performing a few GET requests you should try OpenURI.</p>

<h2 id="simple-examples">Simple Examples</h2>

<p>All examples assume you have loaded Net::HTTP with:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'net/http'</span>
</code></pre></div></div>

<p>This will also require ‘uri’ so you don’t need to require it separately.</p>

<p>The Net::HTTP methods in the following section do not persist
connections. They are not recommended if you are performing many HTTP
requests.</p>

<h3 id="get">GET</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s1">'example.com'</span><span class="p">,</span> <span class="s1">'/index.html'</span><span class="p">)</span> <span class="c1"># =&gt; String</span>
</code></pre></div></div>

<h3 id="get-by-uri">GET by URI</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">'http://example.com/index.html?count=10'</span><span class="p">)</span>
<span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span> <span class="c1"># =&gt; String</span>
</code></pre></div></div>

<h3 id="get-with-dynamic-parameters">GET with Dynamic Parameters</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">'http://example.com/index.html'</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:limit</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span> <span class="ss">:page</span> <span class="o">=&gt;</span> <span class="mi">3</span> <span class="p">}</span>
<span class="n">uri</span><span class="p">.</span><span class="nf">query</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">encode_www_form</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get_response</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">res</span><span class="p">.</span><span class="nf">body</span> <span class="k">if</span> <span class="n">res</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Net</span><span class="o">::</span><span class="no">HTTPSuccess</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="post">POST</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">'http://www.example.com/search.cgi'</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">post_form</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="s1">'q'</span> <span class="o">=&gt;</span> <span class="s1">'ruby'</span><span class="p">,</span> <span class="s1">'max'</span> <span class="o">=&gt;</span> <span class="s1">'50'</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">res</span><span class="p">.</span><span class="nf">body</span>
</code></pre></div></div>

<h3 id="post-with-multiple-values">POST with Multiple Values</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">'http://www.example.com/search.cgi'</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">post_form</span><span class="p">(</span><span class="n">uri</span><span class="p">,</span> <span class="s1">'q'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'ruby'</span><span class="p">,</span> <span class="s1">'perl'</span><span class="p">],</span> <span class="s1">'max'</span> <span class="o">=&gt;</span> <span class="s1">'50'</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">res</span><span class="p">.</span><span class="nf">body</span>
</code></pre></div></div>

<h2 id="how-to-use-nethttp">How to use Net::HTTP</h2>

<p>The following example code can be used as the basis of a HTTP user-agent
which can perform a variety of request types using persistent
connections.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">'http://example.com/some_path?query=string'</span><span class="p">)</span>

<span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
  <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span> <span class="n">uri</span>

  <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span> <span class="n">request</span> <span class="c1"># Net::HTTPResponse object</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Net::HTTP::start immediately creates a connection to an HTTP server
which is kept open for the duration of the block. The connection will
remain open for multiple requests in the block if the server indicates
it supports persistent connections.</p>

<p>If you wish to re-use a connection across multiple HTTP requests without
automatically closing it you can use ::new and then call <code class="highlighter-rouge">#start</code> and
<code class="highlighter-rouge">#finish</code> manually.</p>

<p>The request types Net::HTTP supports are listed below in the section
“HTTP Request Classes”.</p>

<p>For all the Net::HTTP request objects and shortcut request methods you
may supply either a String for the request path or a URI from which
Net::HTTP will extract the request path.</p>

<h3 id="response-data">Response Data</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">'http://example.com/index.html'</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get_response</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>

<span class="c1"># Headers</span>
<span class="n">res</span><span class="p">[</span><span class="s1">'Set-Cookie'</span><span class="p">]</span>            <span class="c1"># =&gt; String</span>
<span class="n">res</span><span class="p">.</span><span class="nf">get_fields</span><span class="p">(</span><span class="s1">'set-cookie'</span><span class="p">)</span> <span class="c1"># =&gt; Array</span>
<span class="n">res</span><span class="p">.</span><span class="nf">to_hash</span><span class="p">[</span><span class="s1">'set-cookie'</span><span class="p">]</span>    <span class="c1"># =&gt; Array</span>
<span class="nb">puts</span> <span class="s2">"Headers: </span><span class="si">#{</span><span class="n">res</span><span class="p">.</span><span class="nf">to_hash</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>

<span class="c1"># Status</span>
<span class="nb">puts</span> <span class="n">res</span><span class="p">.</span><span class="nf">code</span>       <span class="c1"># =&gt; '200'</span>
<span class="nb">puts</span> <span class="n">res</span><span class="p">.</span><span class="nf">message</span>    <span class="c1"># =&gt; 'OK'</span>
<span class="nb">puts</span> <span class="n">res</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span> <span class="c1"># =&gt; 'HTTPOK'</span>

<span class="c1"># Body</span>
<span class="nb">puts</span> <span class="n">res</span><span class="p">.</span><span class="nf">body</span> <span class="k">if</span> <span class="n">res</span><span class="p">.</span><span class="nf">response_body_permitted?</span>
</code></pre></div></div>

<h3 id="following-redirection">Following Redirection</h3>

<p>Each Net::HTTPResponse object belongs to a class for its response code.</p>

<p>For example, all 2XX responses are instances of a Net::HTTPSuccess
subclass, a 3XX response is an instance of a Net::HTTPRedirection
subclass and a 200 response is an instance of the Net::HTTPOK class. For
details of response classes, see the section “HTTP Response Classes”
below.</p>

<p>Using a case statement you can handle various types of responses
properly:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fetch</span><span class="p">(</span><span class="n">uri_str</span><span class="p">,</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
  <span class="c1"># You should choose a better exception.</span>
  <span class="k">raise</span> <span class="no">ArgumentError</span><span class="p">,</span> <span class="s1">'too many HTTP redirects'</span> <span class="k">if</span> <span class="n">limit</span> <span class="o">==</span> <span class="mi">0</span>

  <span class="n">response</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get_response</span><span class="p">(</span><span class="no">URI</span><span class="p">(</span><span class="n">uri_str</span><span class="p">))</span>

  <span class="k">case</span> <span class="n">response</span>
  <span class="k">when</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTPSuccess</span> <span class="k">then</span>
    <span class="n">response</span>
  <span class="k">when</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTPRedirection</span> <span class="k">then</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">'location'</span><span class="p">]</span>
    <span class="nb">warn</span> <span class="s2">"redirected to </span><span class="si">#{</span><span class="n">location</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">fetch</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">limit</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="n">response</span><span class="p">.</span><span class="nf">value</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="nb">print</span> <span class="n">fetch</span><span class="p">(</span><span class="s1">'http://www.ruby-lang.org'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="post-1">POST</h3>

<p>A POST can be made using the Net::HTTP::Post request class. This example
creates a urlencoded POST body:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">'http://www.example.com/todo.cgi'</span><span class="p">)</span>
<span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
<span class="n">req</span><span class="p">.</span><span class="nf">set_form_data</span><span class="p">(</span><span class="s1">'from'</span> <span class="o">=&gt;</span> <span class="s1">'2005-01-01'</span><span class="p">,</span> <span class="s1">'to'</span> <span class="o">=&gt;</span> <span class="s1">'2005-03-31'</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
  <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">case</span> <span class="n">res</span>
<span class="k">when</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTPSuccess</span><span class="p">,</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTPRedirection</span>
  <span class="c1"># OK</span>
<span class="k">else</span>
  <span class="n">res</span><span class="p">.</span><span class="nf">value</span>
<span class="k">end</span>
</code></pre></div></div>

<p>At this time Net::HTTP does not support multipart/form-data. To send
multipart/form-data use <code class="highlighter-rouge">Net::HTTPRequest#body=</code> and
Net::<code class="highlighter-rouge">HTTPRequest#content_type=</code>:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
<span class="n">req</span><span class="p">.</span><span class="nf">body</span> <span class="o">=</span> <span class="n">multipart_data</span>
<span class="n">req</span><span class="p">.</span><span class="nf">content_type</span> <span class="o">=</span> <span class="s1">'multipart/form-data'</span>
</code></pre></div></div>

<p>Other requests that can contain a body such as PUT can be created in the
same way using the corresponding request class (Net::HTTP::Put).</p>

<h3 id="setting-headers">Setting Headers</h3>

<p>The following example performs a conditional GET using the
If-Modified-Since header. If the files has not been modified since the
time in the header a Not Modified response will be returned. See RFC
2616 section 9.3 for further details.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">'http://example.com/cached_response'</span><span class="p">)</span>
<span class="n">file</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">stat</span> <span class="s1">'cached_response'</span>

<span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
<span class="n">req</span><span class="p">[</span><span class="s1">'If-Modified-Since'</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span><span class="p">.</span><span class="nf">mtime</span><span class="p">.</span><span class="nf">rfc2822</span>

<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">http</span><span class="o">|</span>
  <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="p">}</span>

<span class="nb">open</span> <span class="s1">'cached_response'</span><span class="p">,</span> <span class="s1">'w'</span> <span class="k">do</span> <span class="o">|</span><span class="n">io</span><span class="o">|</span>
  <span class="n">io</span><span class="p">.</span><span class="nf">write</span> <span class="n">res</span><span class="p">.</span><span class="nf">body</span>
<span class="k">end</span> <span class="k">if</span> <span class="n">res</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Net</span><span class="o">::</span><span class="no">HTTPSuccess</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="basic-authentication">Basic Authentication</h3>

<p>Basic authentication is performed according to
<a href="http://www.ietf.org/rfc/rfc2617.txt">RFC2617</a></p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">'http://example.com/index.html?key=value'</span><span class="p">)</span>

<span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
<span class="n">req</span><span class="p">.</span><span class="nf">basic_auth</span> <span class="s1">'user'</span><span class="p">,</span> <span class="s1">'pass'</span>

<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">hostname</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">http</span><span class="o">|</span>
  <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="p">}</span>
<span class="nb">puts</span> <span class="n">res</span><span class="p">.</span><span class="nf">body</span>
</code></pre></div></div>

<h3 id="streaming-response-bodies">Streaming Response Bodies</h3>

<p>By default Net::HTTP reads an entire response into memory. If you are
handling large files or wish to implement a progress bar you can instead
stream the body directly to an IO.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">'http://example.com/large_file'</span><span class="p">)</span>

<span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
  <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span> <span class="n">uri</span>

  <span class="n">http</span><span class="p">.</span><span class="nf">request</span> <span class="n">request</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
    <span class="nb">open</span> <span class="s1">'large_file'</span><span class="p">,</span> <span class="s1">'w'</span> <span class="k">do</span> <span class="o">|</span><span class="n">io</span><span class="o">|</span>
      <span class="n">response</span><span class="p">.</span><span class="nf">read_body</span> <span class="k">do</span> <span class="o">|</span><span class="n">chunk</span><span class="o">|</span>
        <span class="n">io</span><span class="p">.</span><span class="nf">write</span> <span class="n">chunk</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="https">HTTPS</h3>

<p>HTTPS is enabled for an HTTP connection by <code class="highlighter-rouge">Net::HTTP#use_ssl=</code>.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">'https://secure.example.com/some_path?query=string'</span><span class="p">)</span>

<span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">uri</span><span class="p">.</span><span class="nf">port</span><span class="p">,</span> <span class="ss">:use_ssl</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
  <span class="n">request</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span> <span class="n">uri</span>
  <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span> <span class="n">request</span> <span class="c1"># Net::HTTPResponse object</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Or if you simply want to make a GET request, you may pass in an URI
object that has a HTTPS URL. Net::HTTP automatically turn on TLS
verification if the URI object has a ‘https’ URI scheme.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">'https://example.com/'</span><span class="p">)</span>
<span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span> <span class="c1"># =&gt; String</span>
</code></pre></div></div>

<p>In previous versions of Ruby you would need to require ‘net/https’ to
use HTTPS. This is no longer true.</p>

<h3 id="proxies">Proxies</h3>

<p>Net::HTTP will automatically create a proxy from the <code class="highlighter-rouge">http_proxy</code>
environment variable if it is present. To disable use of <code class="highlighter-rouge">http_proxy</code>,
pass <code class="highlighter-rouge">nil</code> for the proxy address.</p>

<p>You may also create a custom proxy:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">proxy_addr</span> <span class="o">=</span> <span class="s1">'your.proxy.host'</span>
<span class="n">proxy_port</span> <span class="o">=</span> <span class="mi">8080</span>

<span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'example.com'</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">proxy_addr</span><span class="p">,</span> <span class="n">proxy_port</span><span class="p">).</span><span class="nf">start</span> <span class="p">{</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
  <span class="c1"># always proxy via your.proxy.addr:8080</span>
<span class="p">}</span>
</code></pre></div></div>

<p>See Net::HTTP.new for further details and examples such as proxies that
require a username and password.</p>

<h3 id="compression">Compression</h3>

<p>Net::HTTP automatically adds Accept-Encoding for compression of response
bodies and automatically decompresses gzip and deflate responses unless
a Range header was sent.</p>

<p>Compression can be disabled through the Accept-Encoding: identity
header.</p>

<p><a href="https://ruby-doc.org/stdlib-2.5.0/libdoc/net/http/rdoc/Net::HTTP.html">Net::HTTP
Reference</a></p>



                <!-- Mobile navigation buttons -->


                <!--
                    <a href="cli/cli-tool.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                 -->

            </div>



               <!--
                <a href="cli/cli-tool.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
                 -->

        </div>


        <script src="/js/book.js"></script>
    </body>
</html>

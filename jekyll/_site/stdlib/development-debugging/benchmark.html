


<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title> | </title>

        <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/highlight.css">
        <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'>

        <!-- Font Awesome -->
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='/jquery.js'%3E%3C/script%3E"));
            }
        </script>
    </head>
    <body>
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme = localStorage.getItem('theme');
            if (theme == null) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = localStorage.getItem('sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter">

              
              <li>
                <a href="/about-this-book.html"> About This Book</a>
              </li>
                
              
              <li>
                <a href="/language.html"> Language Structure</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/language/keywords.html"> Keywords</a>
                          </li>
                        
                          <li>
                            <a href="/language/literals.html"> Literals</a>
                          </li>
                        
                          <li>
                            <a href="/language/variables-constants.html"> Variables and Constants</a>
                          </li>
                        
                          <li>
                            <a href="/language/assignment.html"> Assignment</a>
                          </li>
                        
                          <li>
                            <a href="/language/control-expressions.html"> Control Expressions</a>
                          </li>
                        
                          <li>
                            <a href="/language/methods-def.html"> Defining methods</a>
                          </li>
                        
                          <li>
                            <a href="/language/methods-call.html"> Calling methods</a>
                          </li>
                        
                          <li>
                            <a href="/language/modules-classes.html"> Modules and Classes</a>
                          </li>
                        
                          <li>
                            <a href="/language/exceptions.html"> Exceptions</a>
                          </li>
                        
                          <li>
                            <a href="/language/refinements.html"> Refinements</a>
                          </li>
                        
                          <li>
                            <a href="/language/precedence.html"> Precedence</a>
                          </li>
                        
                          <li>
                            <a href="/language/files.html"> File Structure</a>
                          </li>
                        
                          <li>
                            <a href="/language/globals.html"> Globals</a>
                          </li>
                        
                          <li>
                            <a href="/language/metaprogramming.html"> Metaprogramming</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/builtin.html"> Built-in Classes</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/builtin/core.html"> Language Core</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/types.html"> Value Types</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/errors-warnings.html"> Errors and Warnings</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/system-cli.html"> System Programming and CLI</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/concurrency-parallelism.html"> Concurrency and Parallelism</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/internals.html"> Interpreter Internals</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/marshal.html"> Marshal</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/random.html"> Random</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/stdlib.html"> Standard Library</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/stdlib/patterns.html"> Design Patterns</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/formats.html"> Formats</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/development-debugging.html"> Development and Debugging</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/string-utilities.html"> String Utilities</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/networking-web.html"> Networking and Web</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/cli.html"> System Programming and CLI</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/cryptography-encoding.html"> Cryptography and Encoding</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/misc.html"> Miscellaneous Libraries</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/advanced-topics.html"> Advanced Topics</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/advanced-topics/third-party-libraries.html"> Third-Party Libraries</a>
                          </li>
                        
                          <li>
                            <a href="/advanced-topics/tools-approaches.html"> Tools and Approaches</a>
                          </li>
                        
                          <li>
                            <a href="/advanced-topics/contributing.html"> Contributing To Ruby</a>
                          </li>
                        
                    </ul>
                
              

            </ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <i id="print-button" class="fa fa-print" title="Print this book"></i>
                    </div>
                </div>

                 
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'benchmark'</span>
</code></pre></div></div>

<h1 id="benchmark">Benchmark</h1>

<p>The Benchmark module provides methods to measure and report the time
used to execute Ruby code.</p>

<ul>
  <li>
    <p>Measure the time to construct the string given by the expression
<code class="highlighter-rouge">"a"*1_000_000_000</code>:</p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'benchmark'</span>
  
<span class="nb">puts</span> <span class="no">Benchmark</span><span class="p">.</span><span class="nf">measure</span> <span class="p">{</span> <span class="s2">"a"</span><span class="o">*</span><span class="mi">1_000_000_000</span> <span class="p">}</span>
</code></pre></div>    </div>

    <p>On my machine (OSX 10.8.3 on i5 1.7 GHz) this generates:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.350000   0.400000   0.750000 (  0.835234)
</code></pre></div>    </div>

    <p>This report shows the user CPU time, system CPU time, the sum of the
user and system CPU times, and the elapsed real time. The unit of time
is seconds.</p>
  </li>
  <li>
    <p>Do some experiments sequentially using the <code class="highlighter-rouge">#bm</code> method:</p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'benchmark'</span>
  
<span class="n">n</span> <span class="o">=</span> <span class="mi">5000000</span>
<span class="no">Benchmark</span><span class="p">.</span><span class="nf">bm</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
  <span class="n">x</span><span class="p">.</span><span class="nf">report</span> <span class="p">{</span> <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="n">n</span><span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span> <span class="k">end</span> <span class="p">}</span>
  <span class="n">x</span><span class="p">.</span><span class="nf">report</span> <span class="p">{</span> <span class="n">n</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span>   <span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span> <span class="k">end</span> <span class="p">}</span>
  <span class="n">x</span><span class="p">.</span><span class="nf">report</span> <span class="p">{</span> <span class="mi">1</span><span class="p">.</span><span class="nf">upto</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">do</span> <span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span> <span class="k">end</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>    </div>

    <p>The result:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    user     system      total        real
1.010000   0.000000   1.010000 (  1.014479)
1.000000   0.000000   1.000000 (  0.998261)
0.980000   0.000000   0.980000 (  0.981335)
</code></pre></div>    </div>
  </li>
  <li>
    <p>Continuing the previous example, put a label in each report:</p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'benchmark'</span>
  
<span class="n">n</span> <span class="o">=</span> <span class="mi">5000000</span>
<span class="no">Benchmark</span><span class="p">.</span><span class="nf">bm</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
  <span class="n">x</span><span class="p">.</span><span class="nf">report</span><span class="p">(</span><span class="s2">"for:"</span><span class="p">)</span>   <span class="p">{</span> <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="n">n</span><span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span> <span class="k">end</span> <span class="p">}</span>
  <span class="n">x</span><span class="p">.</span><span class="nf">report</span><span class="p">(</span><span class="s2">"times:"</span><span class="p">)</span> <span class="p">{</span> <span class="n">n</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span>   <span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span> <span class="k">end</span> <span class="p">}</span>
  <span class="n">x</span><span class="p">.</span><span class="nf">report</span><span class="p">(</span><span class="s2">"upto:"</span><span class="p">)</span>  <span class="p">{</span> <span class="mi">1</span><span class="p">.</span><span class="nf">upto</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">do</span> <span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span> <span class="k">end</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>The result:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>              user     system      total        real
for:      1.010000   0.000000   1.010000 (  1.015688)
times:    1.000000   0.000000   1.000000 (  1.003611)
upto:     1.030000   0.000000   1.030000 (  1.028098)
</code></pre></div></div>

<ul>
  <li>
    <p>The times for some benchmarks depend on the order in which items are
run. These differences are due to the cost of memory allocation and
garbage collection. To avoid these discrepancies, the #bmbm method is
provided. For example, to compare ways to sort an array of floats:</p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'benchmark'</span>
  
<span class="n">array</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">1000000</span><span class="p">).</span><span class="nf">map</span> <span class="p">{</span> <span class="nb">rand</span> <span class="p">}</span>
  
<span class="no">Benchmark</span><span class="p">.</span><span class="nf">bmbm</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
  <span class="n">x</span><span class="p">.</span><span class="nf">report</span><span class="p">(</span><span class="s2">"sort!"</span><span class="p">)</span> <span class="p">{</span> <span class="n">array</span><span class="p">.</span><span class="nf">dup</span><span class="p">.</span><span class="nf">sort!</span> <span class="p">}</span>
  <span class="n">x</span><span class="p">.</span><span class="nf">report</span><span class="p">(</span><span class="s2">"sort"</span><span class="p">)</span>  <span class="p">{</span> <span class="n">array</span><span class="p">.</span><span class="nf">dup</span><span class="p">.</span><span class="nf">sort</span>  <span class="p">}</span>
<span class="k">end</span>
</code></pre></div>    </div>

    <p>The result:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Rehearsal -----------------------------------------
sort!   1.490000   0.010000   1.500000 (  1.490520)
sort    1.460000   0.000000   1.460000 (  1.463025)
-------------------------------- total: 2.960000sec
  
            user     system      total        real
sort!   1.460000   0.000000   1.460000 (  1.460465)
sort    1.450000   0.010000   1.460000 (  1.448327)
</code></pre></div>    </div>
  </li>
  <li>
    <p>Report statistics of sequential experiments with unique labels, using
the #benchmark method:</p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'benchmark'</span>
<span class="kp">include</span> <span class="no">Benchmark</span>         <span class="c1"># we need the CAPTION and FORMAT constants</span>
  
<span class="n">n</span> <span class="o">=</span> <span class="mi">5000000</span>
<span class="no">Benchmark</span><span class="p">.</span><span class="nf">benchmark</span><span class="p">(</span><span class="no">CAPTION</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="no">FORMAT</span><span class="p">,</span> <span class="s2">"&gt;total:"</span><span class="p">,</span> <span class="s2">"&gt;avg:"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
  <span class="n">tf</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="nf">report</span><span class="p">(</span><span class="s2">"for:"</span><span class="p">)</span>   <span class="p">{</span> <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="n">n</span><span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span> <span class="k">end</span> <span class="p">}</span>
  <span class="n">tt</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="nf">report</span><span class="p">(</span><span class="s2">"times:"</span><span class="p">)</span> <span class="p">{</span> <span class="n">n</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span>   <span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span> <span class="k">end</span> <span class="p">}</span>
  <span class="n">tu</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="nf">report</span><span class="p">(</span><span class="s2">"upto:"</span><span class="p">)</span>  <span class="p">{</span> <span class="mi">1</span><span class="p">.</span><span class="nf">upto</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">do</span> <span class="p">;</span> <span class="n">a</span> <span class="o">=</span> <span class="s2">"1"</span><span class="p">;</span> <span class="k">end</span> <span class="p">}</span>
  <span class="p">[</span><span class="n">tf</span><span class="o">+</span><span class="n">tt</span><span class="o">+</span><span class="n">tu</span><span class="p">,</span> <span class="p">(</span><span class="n">tf</span><span class="o">+</span><span class="n">tt</span><span class="o">+</span><span class="n">tu</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div>    </div>

    <p>The result:</p>

    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>             user     system      total        real
for:      0.950000   0.000000   0.950000 (  0.952039)
times:    0.980000   0.000000   0.980000 (  0.984938)
upto:     0.950000   0.000000   0.950000 (  0.946787)
&gt;total:   2.880000   0.000000   2.880000 (  2.883764)
&gt;avg:     0.960000   0.000000   0.960000 (  0.961255)
</code></pre></div>    </div>
  </li>
</ul>

<p><a href="https://ruby-doc.org/stdlib-2.5.0/libdoc/benchmark/rdoc/Benchmark.html">Benchmark
Reference</a></p>



                <!-- Mobile navigation buttons -->


                <!--
                    <a href="cli/cli-tool.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                 -->

            </div>



               <!--
                <a href="cli/cli-tool.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
                 -->

        </div>


        <script src="/js/book.js"></script>
    </body>
</html>

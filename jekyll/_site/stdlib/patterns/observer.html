


<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title> | </title>

        <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/highlight.css">
        <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'>

        <!-- Font Awesome -->
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='/jquery.js'%3E%3C/script%3E"));
            }
        </script>
    </head>
    <body>
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme = localStorage.getItem('theme');
            if (theme == null) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = localStorage.getItem('sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter">

              
              <li>
                <a href="#about-this-book.html"> About This Book</a>
              </li>
              
              <li>
                <a href="#language.html"> Language Structure</a>
              </li>
              
              <li>
                <a href="#builtin.html"> Built-in Classes</a>
              </li>
              
              <li>
                <a href="#stdlib.html"> Standard Library</a>
              </li>
              
              <li>
                <a href="#advanced-topics.html"> Advanced Topics</a>
              </li>
              

            </ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <i id="print-button" class="fa fa-print" title="Print this book"></i>
                    </div>
                </div>

                 
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'observer'</span>
</code></pre></div></div>

<h1 id="observable">Observable</h1>

<p>The Observer pattern (also known as publish/subscribe) provides a simple
mechanism for one object to inform a set of interested third-party
objects when its state changes.</p>

<h2 id="mechanism">Mechanism</h2>

<p>The notifying class mixes in the <code class="highlighter-rouge">Observable</code> module, which provides the
methods for managing the associated observer objects.</p>

<p>The observable object must:</p>

<ul>
  <li>assert that it has <code class="highlighter-rouge">#changed</code></li>
  <li>call <code class="highlighter-rouge">#notify_observers</code></li>
</ul>

<p>An observer subscribes to updates using <code class="highlighter-rouge">Observable#add_observer</code>, which
also specifies the method called via <code class="highlighter-rouge">#notify_observers</code>. The default
method for <code class="highlighter-rouge">#notify_observers</code> is <code class="highlighter-rouge">#update</code>.</p>

<h3 id="example">Example</h3>

<p>The following example demonstrates this nicely. A <code class="highlighter-rouge">Ticker</code>, when run,
continually receives the stock <code class="highlighter-rouge">Price</code> for its <code class="highlighter-rouge">@symbol</code>. A <code class="highlighter-rouge">Warner</code> is
a general observer of the price, and two warners are demonstrated, a
<code class="highlighter-rouge">WarnLow</code> and a <code class="highlighter-rouge">WarnHigh</code>, which print a warning if the price is below
or above their set limits, respectively.</p>

<p>The <code class="highlighter-rouge">update</code> callback allows the warners to run without being explicitly
called. The system is set up with the <code class="highlighter-rouge">Ticker</code> and several observers,
and the observers do their duty without the top-level code having to
interfere.</p>

<p>Note that the contract between publisher and subscriber (observable and
observer) is not declared or enforced. The <code class="highlighter-rouge">Ticker</code> publishes a time and
a price, and the warners receive that. But if you donâ€™t ensure that your
contracts are correct, nothing else can warn you.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"observer"</span>

<span class="k">class</span> <span class="nc">Ticker</span>          <span class="c1">### Periodically fetch a stock price.</span>
  <span class="kp">include</span> <span class="no">Observable</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="vi">@symbol</span> <span class="o">=</span> <span class="n">symbol</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">run</span>
    <span class="n">last_price</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="kp">loop</span> <span class="k">do</span>
      <span class="n">price</span> <span class="o">=</span> <span class="no">Price</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="vi">@symbol</span><span class="p">)</span>
      <span class="nb">print</span> <span class="s2">"Current price: </span><span class="si">#{</span><span class="n">price</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
      <span class="k">if</span> <span class="n">price</span> <span class="o">!=</span> <span class="n">last_price</span>
        <span class="n">changed</span>                 <span class="c1"># notify observers</span>
        <span class="n">last_price</span> <span class="o">=</span> <span class="n">price</span>
        <span class="n">notify_observers</span><span class="p">(</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
      <span class="k">end</span>
      <span class="nb">sleep</span> <span class="mi">1</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Price</span>           <span class="c1">### A mock class to fetch a stock price (60 - 140).</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">fetch</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="mi">60</span> <span class="o">+</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Warner</span>          <span class="c1">### An abstract observer of Ticker objects.</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
    <span class="vi">@limit</span> <span class="o">=</span> <span class="n">limit</span>
    <span class="n">ticker</span><span class="p">.</span><span class="nf">add_observer</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">WarnLow</span> <span class="o">&lt;</span> <span class="no">Warner</span>
  <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>       <span class="c1"># callback for observer</span>
    <span class="k">if</span> <span class="n">price</span> <span class="o">&lt;</span> <span class="vi">@limit</span>
      <span class="nb">print</span> <span class="s2">"--- </span><span class="si">#{</span><span class="n">time</span><span class="p">.</span><span class="nf">to_s</span><span class="si">}</span><span class="s2">: Price below </span><span class="si">#@limit</span><span class="s2">: </span><span class="si">#{</span><span class="n">price</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">WarnHigh</span> <span class="o">&lt;</span> <span class="no">Warner</span>
  <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>       <span class="c1"># callback for observer</span>
    <span class="k">if</span> <span class="n">price</span> <span class="o">&gt;</span> <span class="vi">@limit</span>
      <span class="nb">print</span> <span class="s2">"+++ </span><span class="si">#{</span><span class="n">time</span><span class="p">.</span><span class="nf">to_s</span><span class="si">}</span><span class="s2">: Price above </span><span class="si">#@limit</span><span class="s2">: </span><span class="si">#{</span><span class="n">price</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">ticker</span> <span class="o">=</span> <span class="no">Ticker</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"MSFT"</span><span class="p">)</span>
<span class="no">WarnLow</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<span class="no">WarnHigh</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">ticker</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
<span class="n">ticker</span><span class="p">.</span><span class="nf">run</span>
</code></pre></div></div>

<p>Produces:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Current</span> <span class="ss">price: </span><span class="mi">83</span>
<span class="no">Current</span> <span class="ss">price: </span><span class="mi">75</span>
<span class="o">---</span> <span class="no">Sun</span> <span class="no">Jun</span> <span class="mi">09</span> <span class="mo">00</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">25</span> <span class="no">CDT</span> <span class="mi">2002</span><span class="p">:</span> <span class="no">Price</span> <span class="n">below</span> <span class="mi">80</span><span class="p">:</span> <span class="mi">75</span>
<span class="no">Current</span> <span class="ss">price: </span><span class="mi">90</span>
<span class="no">Current</span> <span class="ss">price: </span><span class="mi">134</span>
<span class="o">+++</span> <span class="no">Sun</span> <span class="no">Jun</span> <span class="mi">09</span> <span class="mo">00</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">25</span> <span class="no">CDT</span> <span class="mi">2002</span><span class="p">:</span> <span class="no">Price</span> <span class="n">above</span> <span class="mi">120</span><span class="p">:</span> <span class="mi">134</span>
<span class="no">Current</span> <span class="ss">price: </span><span class="mi">134</span>
<span class="no">Current</span> <span class="ss">price: </span><span class="mi">112</span>
<span class="no">Current</span> <span class="ss">price: </span><span class="mi">79</span>
<span class="o">---</span> <span class="no">Sun</span> <span class="no">Jun</span> <span class="mi">09</span> <span class="mo">00</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">25</span> <span class="no">CDT</span> <span class="mi">2002</span><span class="p">:</span> <span class="no">Price</span> <span class="n">below</span> <span class="mi">80</span><span class="p">:</span> <span class="mi">79</span>
</code></pre></div></div>

<p><a href="https://ruby-doc.org/stdlib-2.5.0/libdoc/observer/rdoc/Observable.html">Observable
Reference</a></p>



                <!-- Mobile navigation buttons -->


                <!--
                    <a href="cli/cli-tool.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                 -->

            </div>



               <!--
                <a href="cli/cli-tool.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
                 -->

        </div>


        <script src="js/book.js"></script>
    </body>
</html>




<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title> | </title>

        <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/highlight.css">
        <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'>

        <!-- Font Awesome -->
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='/jquery.js'%3E%3C/script%3E"));
            }
        </script>
    </head>
    <body>
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme = localStorage.getItem('theme');
            if (theme == null) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = localStorage.getItem('sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter">

              
              <li>
                <a href="/about-this-book.html"> About This Book</a>
              </li>
                
              
              <li>
                <a href="/language.html"> Language Structure</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/language/keywords.html"> Keywords</a>
                          </li>
                        
                          <li>
                            <a href="/language/literals.html"> Literals</a>
                          </li>
                        
                          <li>
                            <a href="/language/variables-constants.html"> Variables and Constants</a>
                          </li>
                        
                          <li>
                            <a href="/language/assignment.html"> Assignment</a>
                          </li>
                        
                          <li>
                            <a href="/language/control-expressions.html"> Control Expressions</a>
                          </li>
                        
                          <li>
                            <a href="/language/methods-def.html"> Defining methods</a>
                          </li>
                        
                          <li>
                            <a href="/language/methods-call.html"> Calling methods</a>
                          </li>
                        
                          <li>
                            <a href="/language/modules-classes.html"> Modules and Classes</a>
                          </li>
                        
                          <li>
                            <a href="/language/exceptions.html"> Exceptions</a>
                          </li>
                        
                          <li>
                            <a href="/language/refinements.html"> Refinements</a>
                          </li>
                        
                          <li>
                            <a href="/language/precedence.html"> Precedence</a>
                          </li>
                        
                          <li>
                            <a href="/language/files.html"> File Structure</a>
                          </li>
                        
                          <li>
                            <a href="/language/globals.html"> Globals</a>
                          </li>
                        
                          <li>
                            <a href="/language/metaprogramming.html"> Metaprogramming</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/builtin.html"> Built-in Classes</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/builtin/core.html"> Language Core</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/types.html"> Value Types</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/errors-warnings.html"> Errors and Warnings</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/system-cli.html"> System Programming and CLI</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/concurrency-parallelism.html"> Concurrency and Parallelism</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/internals.html"> Interpreter Internals</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/marshal.html"> Marshal</a>
                          </li>
                        
                          <li>
                            <a href="/builtin/random.html"> Random</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/stdlib.html"> Standard Library</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/stdlib/patterns.html"> Design Patterns</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/formats.html"> Formats</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/development-debugging.html"> Development and Debugging</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/string-utilities.html"> String Utilities</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/networking-web.html"> Networking and Web</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/cli.html"> System Programming and CLI</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/cryptography-encoding.html"> Cryptography and Encoding</a>
                          </li>
                        
                          <li>
                            <a href="/stdlib/misc.html"> Miscellaneous Libraries</a>
                          </li>
                        
                    </ul>
                
              
              <li>
                <a href="/advanced-topics.html"> Advanced Topics</a>
              </li>
                
                    <ul class="section">
                        
                          <li>
                            <a href="/advanced-topics/third-party-libraries.html"> Third-Party Libraries</a>
                          </li>
                        
                          <li>
                            <a href="/advanced-topics/tools-approaches.html"> Tools and Approaches</a>
                          </li>
                        
                          <li>
                            <a href="/advanced-topics/contributing.html"> Contributing To Ruby</a>
                          </li>
                        
                    </ul>
                
              

            </ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <i id="print-button" class="fa fa-print" title="Print this book"></i>
                    </div>
                </div>

                 
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'forwardable'</span>
</code></pre></div></div>

<h1 id="forwardable">Forwardable</h1>

<p>The Forwardable module provides delegation of specified methods to a
designated object, using the methods <code class="highlighter-rouge">#def_delegator</code> and
<code class="highlighter-rouge">#def_delegators</code>.</p>

<p>For example, say you have a class RecordCollection which contains an
array <code class="highlighter-rouge">@records</code>. You could provide the lookup method
<code class="highlighter-rouge">#record_number</code>(), which simply calls <code class="highlighter-rouge">#[]</code> on the <code class="highlighter-rouge">@records</code> array,
like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'forwardable'</span>

<span class="k">class</span> <span class="nc">RecordCollection</span>
  <span class="nb">attr_accessor</span> <span class="ss">:records</span>
  <span class="kp">extend</span> <span class="no">Forwardable</span>
  <span class="n">def_delegator</span> <span class="ss">:@records</span><span class="p">,</span> <span class="ss">:[]</span><span class="p">,</span> <span class="ss">:record_number</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We can use the lookup method like so:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">r</span> <span class="o">=</span> <span class="no">RecordCollection</span><span class="p">.</span><span class="nf">new</span>
<span class="n">r</span><span class="p">.</span><span class="nf">records</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="n">r</span><span class="p">.</span><span class="nf">record_number</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># =&gt; 4</span>
</code></pre></div></div>

<p>Further, if you wish to provide the methods <code class="highlighter-rouge">#size</code>, #«, and <code class="highlighter-rouge">#map</code>,
all of which delegate to @records, this is how you can do it:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RecordCollection</span> <span class="c1"># re-open RecordCollection class</span>
  <span class="n">def_delegators</span> <span class="ss">:@records</span><span class="p">,</span> <span class="ss">:size</span><span class="p">,</span> <span class="ss">:&lt;&lt;</span><span class="p">,</span> <span class="ss">:map</span>
<span class="k">end</span>

<span class="n">r</span> <span class="o">=</span> <span class="no">RecordCollection</span><span class="p">.</span><span class="nf">new</span>
<span class="n">r</span><span class="p">.</span><span class="nf">records</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">r</span><span class="p">.</span><span class="nf">record_number</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>   <span class="c1"># =&gt; 1</span>
<span class="n">r</span><span class="p">.</span><span class="nf">size</span>               <span class="c1"># =&gt; 3</span>
<span class="n">r</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span>               <span class="c1"># =&gt; [1, 2, 3, 4]</span>
<span class="n">r</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">}</span>  <span class="c1"># =&gt; [2, 4, 6, 8]</span>
</code></pre></div></div>

<p>You can even extend regular objects with Forwardable.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">my_hash</span> <span class="o">=</span> <span class="no">Hash</span><span class="p">.</span><span class="nf">new</span>
<span class="n">my_hash</span><span class="p">.</span><span class="nf">extend</span> <span class="no">Forwardable</span>              <span class="c1"># prepare object for delegation</span>
<span class="n">my_hash</span><span class="p">.</span><span class="nf">def_delegator</span> <span class="s2">"STDOUT"</span><span class="p">,</span> <span class="s2">"puts"</span>  <span class="c1"># add delegation for STDOUT.puts()</span>
<span class="n">my_hash</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"Howdy!"</span>
</code></pre></div></div>

<h2 id="another-example">Another example</h2>

<p>We want to rely on what has come before obviously, but with delegation
we can take just the methods we need and even rename them as
appropriate. In many cases this is preferable to inheritance, which
gives us the entire old interface, even if much of it isn’t needed.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Queue</span>
  <span class="kp">extend</span> <span class="no">Forwardable</span>

  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@q</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>    <span class="c1"># prepare delegate object</span>
  <span class="k">end</span>

  <span class="c1"># setup preferred interface, enq() and deq()...</span>
  <span class="n">def_delegator</span> <span class="ss">:@q</span><span class="p">,</span> <span class="ss">:push</span><span class="p">,</span> <span class="ss">:enq</span>
  <span class="n">def_delegator</span> <span class="ss">:@q</span><span class="p">,</span> <span class="ss">:shift</span><span class="p">,</span> <span class="ss">:deq</span>

  <span class="c1"># support some general Array methods that fit Queues well</span>
  <span class="n">def_delegators</span> <span class="ss">:@q</span><span class="p">,</span> <span class="ss">:clear</span><span class="p">,</span> <span class="ss">:first</span><span class="p">,</span> <span class="ss">:push</span><span class="p">,</span> <span class="ss">:shift</span><span class="p">,</span> <span class="ss">:size</span>
<span class="k">end</span>

<span class="n">q</span> <span class="o">=</span> <span class="no">Queue</span><span class="p">.</span><span class="nf">new</span>
<span class="n">q</span><span class="p">.</span><span class="nf">enq</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span>
<span class="n">q</span><span class="p">.</span><span class="nf">push</span> <span class="mi">6</span>

<span class="n">q</span><span class="p">.</span><span class="nf">shift</span>    <span class="c1"># =&gt; 1</span>
<span class="k">while</span> <span class="n">q</span><span class="p">.</span><span class="nf">size</span> <span class="o">&gt;</span> <span class="mi">0</span>
  <span class="nb">puts</span> <span class="n">q</span><span class="p">.</span><span class="nf">deq</span>
<span class="k">end</span>

<span class="n">q</span><span class="p">.</span><span class="nf">enq</span> <span class="s2">"Ruby"</span><span class="p">,</span> <span class="s2">"Perl"</span><span class="p">,</span> <span class="s2">"Python"</span>
<span class="nb">puts</span> <span class="n">q</span><span class="p">.</span><span class="nf">first</span>
<span class="n">q</span><span class="p">.</span><span class="nf">clear</span>
<span class="nb">puts</span> <span class="n">q</span><span class="p">.</span><span class="nf">first</span>
</code></pre></div></div>

<p>This should output:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">4</span>
<span class="mi">5</span>
<span class="mi">6</span>
<span class="no">Ruby</span>
<span class="kp">nil</span>
</code></pre></div></div>

<h2 id="notes">Notes</h2>

<p>Be advised, RDoc will not detect delegated methods.</p>

<p><code class="highlighter-rouge">forwardable.rb</code> provides single-method delegation via the
def_delegator and def_delegators methods. For full-class delegation
via DelegateClass, see <code class="highlighter-rouge">delegate.rb</code>.</p>

<p><a href="https://ruby-doc.org/stdlib-2.5.0/libdoc/forwardable/rdoc/Forwardable.html">Forwardable
Reference</a></p>

<h2 id="singleforwardable">SingleForwardable</h2>

<p>SingleForwardable can be used to setup delegation at the object level as
well.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">printer</span> <span class="o">=</span> <span class="no">String</span><span class="p">.</span><span class="nf">new</span>
<span class="n">printer</span><span class="p">.</span><span class="nf">extend</span> <span class="no">SingleForwardable</span>        <span class="c1"># prepare object for delegation</span>
<span class="n">printer</span><span class="p">.</span><span class="nf">def_delegator</span> <span class="s2">"STDOUT"</span><span class="p">,</span> <span class="s2">"puts"</span>  <span class="c1"># add delegation for STDOUT.puts()</span>
<span class="n">printer</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"Howdy!"</span>
</code></pre></div></div>

<p>Also, SingleForwardable can be used to set up delegation for a Class or
Module.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Implementation</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">service</span>
    <span class="nb">puts</span> <span class="s2">"serviced!"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nn">Facade</span>
  <span class="kp">extend</span> <span class="no">SingleForwardable</span>
  <span class="n">def_delegator</span> <span class="ss">:Implementation</span><span class="p">,</span> <span class="ss">:service</span>
<span class="k">end</span>

<span class="no">Facade</span><span class="p">.</span><span class="nf">service</span> <span class="c1">#=&gt; serviced!</span>
</code></pre></div></div>

<p>If you want to use both Forwardable and SingleForwardable, you can use
methods def_instance_delegator and def_single_delegator, etc.</p>

<p><a href="https://ruby-doc.org/stdlib-2.5.0/libdoc/forwardable/rdoc/SingleForwardable.html">SingleForwardable
Reference</a></p>



                <!-- Mobile navigation buttons -->


                <!--
                    <a href="cli/cli-tool.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                 -->

            </div>



               <!--
                <a href="cli/cli-tool.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
                 -->

        </div>


        <script src="/js/book.js"></script>
    </body>
</html>

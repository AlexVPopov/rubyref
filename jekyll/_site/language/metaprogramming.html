


<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title> | </title>

        <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/highlight.css">
        <link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800'>

        <!-- Font Awesome -->
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='/jquery.js'%3E%3C/script%3E"));
            }
        </script>
    </head>
    <body>
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme = localStorage.getItem('theme');
            if (theme == null) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = localStorage.getItem('sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter">

              
              <li>
                <a href="#about-this-book.html"> About This Book</a>
              </li>
              
              <li>
                <a href="#language.html"> Language Structure</a>
              </li>
              
              <li>
                <a href="#builtin.html"> Built-in Classes</a>
              </li>
              
              <li>
                <a href="#stdlib.html"> Standard Library</a>
              </li>
              
              <li>
                <a href="#advanced-topics.html"> Advanced Topics</a>
              </li>
              

            </ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <i id="print-button" class="fa fa-print" title="Print this book"></i>
                    </div>
                </div>

                 <h1 id="ruby-metaprogramming">Ruby Metaprogramming</h1>

<p>Ruby is known to have very powerful <strong>metaprogramming</strong> capabilities,
that is, defining language structures (classes, modules, methods) at
runtime. Unlike many other languages, Ruby’s metaprogramming does not
use special constructs different from “normal” programming, like macros,
decorators or templates. The power of Ruby’s metaprogramming comes from
two facts:</p>

<ul>
  <li>Everything is an object;</li>
  <li>Core classes are hackable.</li>
</ul>

<h2 id="everything-is-an-object">Everything is an object</h2>

<p>That also include core language concepts like classes and methods. They
can be inspected and changed at runtime.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">A</span>
  <span class="k">def</span> <span class="nf">m</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">A</span><span class="p">.</span><span class="nf">class</span>   <span class="c1">#=&gt; Class</span>
<span class="no">A</span><span class="p">.</span><span class="nf">methods</span> <span class="c1">#=&gt; [:new, :allocate, :superclass, ....</span>
<span class="no">A</span><span class="p">.</span><span class="nf">instance_method</span><span class="p">(</span><span class="ss">:m</span><span class="p">)</span> <span class="c1">#=&gt; #&lt;UnboundMethod: A#m&gt;</span>
<span class="no">A</span><span class="p">.</span><span class="nf">instance_method</span><span class="p">(</span><span class="ss">:m</span><span class="p">).</span><span class="nf">parameters</span> <span class="c1">#=&gt; [[:req, :x], [:req, :y]]</span>
</code></pre></div></div>

<h2 id="core-classes-are-hackable">Core classes are hackable</h2>

<p>Core classes (like <code class="highlighter-rouge">Class</code>, <code class="highlighter-rouge">Module</code>, <code class="highlighter-rouge">Method</code>) provide methods to
change their behavior and define new concepts with regular Ruby code:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Define methods with names stored in variable</span>
<span class="k">class</span> <span class="nc">A</span>
  <span class="p">[:</span><span class="o">+</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="p">,</span> <span class="p">:</span><span class="o">*</span><span class="p">,</span> <span class="ss">:/</span><span class="p">].</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">op</span><span class="o">|</span>
    <span class="n">define_method</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1"># ...</span>
    <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># Call methods, names stored in variable</span>
<span class="p">[:</span><span class="o">+</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="p">,</span> <span class="p">:</span><span class="o">*</span><span class="p">,</span> <span class="ss">:/</span><span class="p">].</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">op</span><span class="o">|</span> <span class="mi">100</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="p">}</span> <span class="c1">#=&gt; [110, 90, 1000, 10]</span>

<span class="c1"># Create classes and assign to constants</span>
<span class="p">[</span><span class="ss">:A</span><span class="p">,</span> <span class="ss">:B</span><span class="p">,</span> <span class="ss">:C</span><span class="p">].</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="nb">name</span><span class="o">|</span> <span class="no">Kernel</span><span class="p">.</span><span class="nf">const_set</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="no">Class</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div></div>

<p>TODO: Add useful metaprogramming example (<code class="highlighter-rouge">memoize</code>?)</p>

<p>See <a href="/builtin/core.html">Language Core</a> classes documentation to
understand what you can do with core objects.</p>



                <!-- Mobile navigation buttons -->


                <!--
                    <a href="cli/cli-tool.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                 -->

            </div>



               <!--
                <a href="cli/cli-tool.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
                 -->

        </div>


        <script src="js/book.js"></script>
    </body>
</html>
